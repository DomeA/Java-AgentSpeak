<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CCreateDistribution.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">LightJason AgentSpeak(L++)</a> &gt; <a href="index.source.html" class="el_package">org.lightjason.agentspeak.action.builtin.math.statistic</a> &gt; <span class="el_source">CCreateDistribution.java</span></div><h1>CCreateDistribution.java</h1><pre class="source lang-java linenums">/*
 * @cond LICENSE
 * ######################################################################################
 * # LGPL License                                                                       #
 * #                                                                                    #
 * # This file is part of the LightJason AgentSpeak(L++)                                #
 * # Copyright (c) 2015-19, LightJason (info@lightjason.org)                            #
 * # This program is free software: you can redistribute it and/or modify               #
 * # it under the terms of the GNU Lesser General Public License as                     #
 * # published by the Free Software Foundation, either version 3 of the                 #
 * # License, or (at your option) any later version.                                    #
 * #                                                                                    #
 * # This program is distributed in the hope that it will be useful,                    #
 * # but WITHOUT ANY WARRANTY; without even the implied warranty of                     #
 * # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                      #
 * # GNU Lesser General Public License for more details.                                #
 * #                                                                                    #
 * # You should have received a copy of the GNU Lesser General Public License           #
 * # along with this program. If not, see http://www.gnu.org/licenses/                  #
 * ######################################################################################
 * @endcond
 */

package org.lightjason.agentspeak.action.builtin.math.statistic;

import org.apache.commons.math3.distribution.AbstractRealDistribution;
import org.apache.commons.math3.distribution.BetaDistribution;
import org.apache.commons.math3.distribution.CauchyDistribution;
import org.apache.commons.math3.distribution.ChiSquaredDistribution;
import org.apache.commons.math3.distribution.ExponentialDistribution;
import org.apache.commons.math3.distribution.FDistribution;
import org.apache.commons.math3.distribution.GammaDistribution;
import org.apache.commons.math3.distribution.GumbelDistribution;
import org.apache.commons.math3.distribution.LaplaceDistribution;
import org.apache.commons.math3.distribution.LevyDistribution;
import org.apache.commons.math3.distribution.LogNormalDistribution;
import org.apache.commons.math3.distribution.LogisticDistribution;
import org.apache.commons.math3.distribution.NakagamiDistribution;
import org.apache.commons.math3.distribution.NormalDistribution;
import org.apache.commons.math3.distribution.ParetoDistribution;
import org.apache.commons.math3.distribution.TDistribution;
import org.apache.commons.math3.distribution.TriangularDistribution;
import org.apache.commons.math3.distribution.UniformRealDistribution;
import org.apache.commons.math3.distribution.WeibullDistribution;
import org.apache.commons.math3.random.ISAACRandom;
import org.apache.commons.math3.random.JDKRandomGenerator;
import org.apache.commons.math3.random.MersenneTwister;
import org.apache.commons.math3.random.RandomGenerator;
import org.apache.commons.math3.random.SynchronizedRandomGenerator;
import org.apache.commons.math3.random.Well1024a;
import org.apache.commons.math3.random.Well19937a;
import org.apache.commons.math3.random.Well19937c;
import org.apache.commons.math3.random.Well44497a;
import org.apache.commons.math3.random.Well44497b;
import org.apache.commons.math3.random.Well512a;
import org.lightjason.agentspeak.action.builtin.IBuiltinAction;
import org.lightjason.agentspeak.error.CIllegalStateException;
import org.lightjason.agentspeak.language.CCommon;
import org.lightjason.agentspeak.language.CRawTerm;
import org.lightjason.agentspeak.language.ITerm;
import org.lightjason.agentspeak.language.execution.IContext;
import org.lightjason.agentspeak.language.fuzzy.CFuzzyValue;
import org.lightjason.agentspeak.language.fuzzy.IFuzzyValue;

import javax.annotation.Nonnegative;
import javax.annotation.Nonnull;
import java.util.AbstractMap;
import java.util.Arrays;
import java.util.Collections;
import java.util.List;
import java.util.Locale;
import java.util.Set;
import java.util.stream.Collectors;
import java.util.stream.IntStream;


/**
 * creates a distribution object.
 * The action creates a distribution objects, with an individual
 * pseudo-random generator and different distribution paramter,
 * the action never fails, the following distributions are supported
 * with the following number of numeric arguments
 *
 * + beta distribution with 2 arguments (\f$ \alpha \f$ and \f$ \beta \f$)
 * + cauchy distribution with 2 arguments (media and scale)
 * + chi-square distribution with 1 argument (degree off freedom)
 * + exponential distribution with 1 argument (mean)
 * + f distribution with 2 arguments (degrees of freedom, denominator degrees of freedom)
 * + gamma distribution with 2 arguments (shape and scale)
 * + gumble distribution with 2 arguments (\f$ \mu \f$ and \f$ \beta \f$)
 * + laplace distirbution with 2 arguments (\f$ \mu \f$ and \f$ \beta \f$)
 * + levy distirbution with 2 arguments (\f$ \mu \f$ and \f$ c \f$)
 * + logistic distirbution with 2 arguments (\f$ \mu \f$ and \f$ s \f$)
 * + lognormal distirbution with 2 arguments (scale and shape)
 * + nakagami distribution with 2 arguments (\f$ \mu \f$ and \f$ \omega \f$)
 * + normal distribution with 2 arguments (expected value, variance)
 * + pareto distribution with 2 arguments (scale and shape)
 * + t distribution with 1 argument (degrees of freedom)
 * + triangular distribution with 3 arguments (a, b, c)
 * + uniform distribution with 2 arguments (lower and upper)
 * + weibull distribution with 2 arguments (\f$ \alpha \f$ and \f$ \beta \f$)
 *
 * The following pseudo-random number generators are supported:
 *
 * + mersennetwister (default)
 * + synchronizedmersennetwister
 * + isaac
 * + synchronizedisaac
 * + internal
 * + synchronizedinternal
 * + well512a
 * + synchronizedwell512a
 * + well1024a
 * + synchronizedwell1024a
 * + well19937a
 * + synchronizedwell19937a
 * + well19937c
 * + synchronizedwell19937c
 * + well4449a
 * + synchronizedwell4449a
 * + well44497b
 * + synchronizedwell44497b
 *
 * {@code [D1|D2] = math/statistic/createdistribution( &quot;normal&quot;, 20, 10, [&quot;beta&quot;, &quot;isaac&quot;, [8, 12]] );}
 * @see https://en.wikipedia.org/wiki/Beta_distribution
 * @see https://en.wikipedia.org/wiki/Cauchy_distribution
 * @see https://en.wikipedia.org/wiki/Chi-squared_distribution
 * @see https://en.wikipedia.org/wiki/Exponential_distribution
 * @see https://en.wikipedia.org/wiki/F-distribution
 * @see https://en.wikipedia.org/wiki/Gamma_distribution
 * @see https://en.wikipedia.org/wiki/Gumbel_distribution
 * @see https://en.wikipedia.org/wiki/L%C3%A9vy_distribution
 * @see https://en.wikipedia.org/wiki/Logistic_distribution
 * @see https://en.wikipedia.org/wiki/Log-normal_distribution
 * @see https://en.wikipedia.org/wiki/Nakagami_distribution
 * @see https://en.wikipedia.org/wiki/Normal_distribution
 * @see https://en.wikipedia.org/wiki/Pareto_distribution
 * @see https://en.wikipedia.org/wiki/Student%27s_t-distribution
 * @see https://en.wikipedia.org/wiki/Triangular_distribution
 * @see https://en.wikipedia.org/wiki/Uniform_distribution_(continuous)
 * @see https://en.wikipedia.org/wiki/Weibull_distribution
 */
public final class CCreateDistribution extends IBuiltinAction
{
    /**
     * serial id
     */
    private static final long serialVersionUID = 614460992147593598L;

    /**
     * ctor
     */
    public CCreateDistribution()
    {
<span class="fc" id="L155">        super( 3 );</span>
<span class="fc" id="L156">    }</span>

    @Nonnegative
    @Override
    public final int minimalArgumentNumber()
    {
<span class="fc" id="L162">        return 1;</span>
    }

    @Nonnull
    @Override
    public final IFuzzyValue&lt;Boolean&gt; execute( final boolean p_parallel, @Nonnull final IContext p_context,
                                               @Nonnull final List&lt;ITerm&gt; p_argument, @Nonnull final List&lt;ITerm&gt; p_return )
    {
<span class="fc" id="L170">        final List&lt;ITerm&gt; l_arguments = CCommon.flatten( p_argument ).collect( Collectors.toList() );</span>

<span class="fc" id="L172">        IntStream.range( 0, l_arguments.size() )</span>
<span class="fc" id="L173">                 .filter( i -&gt; CCommon.rawvalueAssignableTo( l_arguments.get( i ), String.class ) )</span>
<span class="fc" id="L174">                 .mapToObj( i -&gt; new AbstractMap.SimpleImmutableEntry&lt;&gt;( i, l_arguments.get( i ).&lt;String&gt;raw() ) )</span>
<span class="fc" id="L175">                 .filter( i -&gt; EDistribution.exist( i.getValue() ) )</span>
<span class="fc" id="L176">                 .map( i -&gt; new AbstractMap.SimpleImmutableEntry&lt;&gt;( i.getKey(), EDistribution.from( i.getValue() ) ) )</span>
<span class="fc" id="L177">                 .map( i -&gt;</span>
                 {

                     // check if next argument to the distribution name a generator name
                     final int l_skip;
                     final EGenerator l_generator;

<span class="pc bpc" id="L184" title="1 of 4 branches missed.">                     if ( ( i.getKey() &lt; l_arguments.size() - 1 ) &amp;&amp; ( CCommon.rawvalueAssignableTo( l_arguments.get( i.getKey() + 1 ), String.class ) ) )</span>
                     {
<span class="fc" id="L186">                         l_skip = 1;</span>
<span class="fc" id="L187">                         l_generator = EGenerator.from( l_arguments.get( i.getKey() + 1 ).&lt;String&gt;raw() );</span>
                     }
                     else
                     {
<span class="fc" id="L191">                         l_skip = 0;</span>
<span class="fc" id="L192">                         l_generator = EGenerator.MERSENNETWISTER;</span>
                     }

                     // generate distribution object, arguments after distribution are the initialize parameter
<span class="fc" id="L196">                     return i.getValue()</span>
<span class="fc" id="L197">                             .get(</span>
<span class="fc" id="L198">                                 l_generator.get(),</span>
<span class="fc" id="L199">                                 l_arguments.stream()</span>
<span class="fc" id="L200">                                            .skip( i.getKey() + 1 + l_skip )</span>
<span class="fc" id="L201">                                            .limit( i.getValue().getArgumentNumber() )</span>
<span class="fc" id="L202">                                            .map( ITerm::&lt;Number&gt;raw )</span>
<span class="fc" id="L203">                                            .mapToDouble( Number::doubleValue )</span>
<span class="fc" id="L204">                                            .toArray()</span>
                             );

                 } )
<span class="fc" id="L208">                 .map( CRawTerm::from )</span>
<span class="fc" id="L209">                 .forEach( p_return::add );</span>

<span class="fc" id="L211">        return CFuzzyValue.from( true );</span>
    }


    /**
     * usable distributions
     */
<span class="fc" id="L218">    private enum EDistribution</span>
    {
<span class="fc" id="L220">        BETA( 2 ),</span>
<span class="fc" id="L221">        CAUCHY( 2 ),</span>
<span class="fc" id="L222">        CHISQUARE( 1 ),</span>
<span class="fc" id="L223">        EXPONENTIAL( 1 ),</span>
<span class="fc" id="L224">        F( 2 ),</span>
<span class="fc" id="L225">        GAMMA( 2 ),</span>
<span class="fc" id="L226">        GUMBLE( 2 ),</span>
<span class="fc" id="L227">        LAPLACE( 2 ),</span>
<span class="fc" id="L228">        LEVY( 2 ),</span>
<span class="fc" id="L229">        LOGISTIC( 2 ),</span>
<span class="fc" id="L230">        LOGNORMAL( 2 ),</span>
<span class="fc" id="L231">        NAKAGAMI( 2 ),</span>
<span class="fc" id="L232">        NORMAL( 2 ),</span>
<span class="fc" id="L233">        PARETO( 2 ),</span>
<span class="fc" id="L234">        T( 1 ),</span>
<span class="fc" id="L235">        TRIANGULAR( 3 ),</span>
<span class="fc" id="L236">        UNIFORM( 2 ),</span>
<span class="fc" id="L237">        WEIBULL( 2 );</span>

        /**
         * enum name list
         */
<span class="fc" id="L242">        private static final Set&lt;String&gt; NAMES = Collections.unmodifiableSet(</span>
<span class="fc" id="L243">                                                    Arrays.stream( EDistribution.values() )</span>
<span class="fc" id="L244">                                                          .map( i -&gt; i.name().toUpperCase( Locale.ROOT ) )</span>
<span class="fc" id="L245">                                                          .collect( Collectors.toSet() )</span>
        );

        /**
         * number of arguments
         */
        private final int m_arguments;

        /**
         * ctor
         *
         * @param p_arguments number of arguments
         */
        EDistribution( final int p_arguments )
<span class="fc" id="L259">        {</span>
<span class="fc" id="L260">            m_arguments = p_arguments;</span>
<span class="fc" id="L261">        }</span>

        /**
         * additional factory
         *
         * @param p_value string
         * @return enum
         */
        @Nonnull
        public static EDistribution from( @Nonnull final String p_value )
        {
<span class="fc" id="L272">            return EDistribution.valueOf( p_value.trim().toUpperCase( Locale.ROOT ) );</span>
        }

        /**
         * checks if a name exists within the enum
         *
         * @param p_value string name
         * @return exist boolean
         */
        public static boolean exist( @Nonnull final String p_value )
        {
<span class="fc" id="L283">            return NAMES.contains( p_value.trim().toUpperCase( Locale.ROOT ) );</span>
        }

        /**
         * return number of arguments
         *
         * @return argument number
         */
        public final int getArgumentNumber()
        {
<span class="fc" id="L293">            return m_arguments;</span>
        }

        /**
         * returns the distribution object
         *
         * @param p_generator random generator
         * @param p_arguments arguments
         * @return real distribution
         */
        @Nonnull
        public final AbstractRealDistribution get( @Nonnull final RandomGenerator p_generator, final double[] p_arguments )
        {
<span class="pc bpc" id="L306" title="1 of 19 branches missed.">            switch ( this )</span>
            {
                case BETA:
<span class="fc" id="L309">                    return new BetaDistribution( p_generator, p_arguments[0], p_arguments[1] );</span>

                case CAUCHY:
<span class="fc" id="L312">                    return new CauchyDistribution( p_generator, p_arguments[0], p_arguments[1] );</span>

                case CHISQUARE:
<span class="fc" id="L315">                    return new ChiSquaredDistribution( p_generator, p_arguments[0] );</span>

                case EXPONENTIAL:
<span class="fc" id="L318">                    return new ExponentialDistribution( p_generator, p_arguments[0] );</span>

                case F:
<span class="fc" id="L321">                    return new FDistribution( p_generator, p_arguments[0], p_arguments[1] );</span>

                case GAMMA:
<span class="fc" id="L324">                    return new GammaDistribution( p_generator, p_arguments[0], p_arguments[1] );</span>

                case GUMBLE:
<span class="fc" id="L327">                    return new GumbelDistribution( p_generator, p_arguments[0], p_arguments[1] );</span>

                case LAPLACE:
<span class="fc" id="L330">                    return new LaplaceDistribution( p_generator, p_arguments[0], p_arguments[1] );</span>

                case LEVY:
<span class="fc" id="L333">                    return new LevyDistribution( p_generator, p_arguments[0], p_arguments[1] );</span>

                case LOGISTIC:
<span class="fc" id="L336">                    return new LogisticDistribution( p_generator, p_arguments[0], p_arguments[1] );</span>

                case LOGNORMAL:
<span class="fc" id="L339">                    return new LogNormalDistribution( p_generator, p_arguments[0], p_arguments[1] );</span>

                case NAKAGAMI:
<span class="fc" id="L342">                    return new NakagamiDistribution(</span>
                        p_generator, p_arguments[0], p_arguments[1],
                        NakagamiDistribution.DEFAULT_INVERSE_ABSOLUTE_ACCURACY
                    );

                case NORMAL:
<span class="fc" id="L348">                    return new NormalDistribution( p_generator, p_arguments[0], p_arguments[1] );</span>

                case PARETO:
<span class="fc" id="L351">                    return new ParetoDistribution( p_generator, p_arguments[0], p_arguments[1] );</span>

                case T:
<span class="fc" id="L354">                    return new TDistribution( p_generator, p_arguments[0] );</span>

                case TRIANGULAR:
<span class="fc" id="L357">                    return new TriangularDistribution( p_generator, p_arguments[0], p_arguments[1], p_arguments[2] );</span>

                case UNIFORM:
<span class="fc" id="L360">                    return new UniformRealDistribution( p_generator, p_arguments[0], p_arguments[1] );</span>

                case WEIBULL:
<span class="fc" id="L363">                    return new WeibullDistribution( p_generator, p_arguments[0], p_arguments[1] );</span>

                default:
<span class="nc" id="L366">                    throw new CIllegalStateException( org.lightjason.agentspeak.common.CCommon.languagestring( this, &quot;unknown&quot;, this ) );</span>
            }
        }
    }

    /**
     * number generator
     */
<span class="fc" id="L374">    private enum EGenerator</span>
    {
<span class="fc" id="L376">        MERSENNETWISTER,</span>
<span class="fc" id="L377">        SYNCHRONIZEDMERSENNETWISTER,</span>
<span class="fc" id="L378">        ISAAC,</span>
<span class="fc" id="L379">        SYNCHRONIZEDISAAC,</span>
<span class="fc" id="L380">        INTERNAL,</span>
<span class="fc" id="L381">        SYNCHRONIZEDINTERNAL,</span>
<span class="fc" id="L382">        WELL512A,</span>
<span class="fc" id="L383">        SYNCHRONIZEDWELL512A,</span>
<span class="fc" id="L384">        WELL1024A,</span>
<span class="fc" id="L385">        SYNCHRONIZEDWELL1024A,</span>
<span class="fc" id="L386">        WELL19937A,</span>
<span class="fc" id="L387">        SYNCHRONIZEDWELL19937A,</span>
<span class="fc" id="L388">        WELL19937C,</span>
<span class="fc" id="L389">        SYNCHRONIZEDWELL19937C,</span>
<span class="fc" id="L390">        WELL4449A,</span>
<span class="fc" id="L391">        SYNCHRONIZEDWELL4449A,</span>
<span class="fc" id="L392">        WELL44497B,</span>
<span class="fc" id="L393">        SYNCHRONIZEDWELL44497B;</span>

        /**
         * additional factory
         *
         * @param p_value string
         * @return enum
         */
        @Nonnull
        public static EGenerator from( @Nonnull final String p_value )
        {
<span class="fc" id="L404">            return EGenerator.valueOf( p_value.trim().toUpperCase( Locale.ROOT ) );</span>
        }

        /**
         * returns a number generator
         *
         * @return generator
         */
        @Nonnull
        public final RandomGenerator get()
        {
<span class="pc bpc" id="L415" title="1 of 19 branches missed.">            switch ( this )</span>
            {
                case MERSENNETWISTER:
<span class="fc" id="L418">                    return new MersenneTwister();</span>

                case SYNCHRONIZEDMERSENNETWISTER:
<span class="fc" id="L421">                    return new SynchronizedRandomGenerator( new MersenneTwister() );</span>

                case ISAAC:
<span class="fc" id="L424">                    return new ISAACRandom();</span>

                case SYNCHRONIZEDISAAC:
<span class="fc" id="L427">                    return new SynchronizedRandomGenerator( new ISAACRandom() );</span>

                case INTERNAL:
<span class="fc" id="L430">                    return new JDKRandomGenerator();</span>

                case SYNCHRONIZEDINTERNAL:
<span class="fc" id="L433">                    return new SynchronizedRandomGenerator( new JDKRandomGenerator() );</span>

                case WELL512A:
<span class="fc" id="L436">                    return new Well512a();</span>

                case SYNCHRONIZEDWELL512A:
<span class="fc" id="L439">                    return new SynchronizedRandomGenerator( new Well512a() );</span>

                case WELL1024A:
<span class="fc" id="L442">                    return new Well1024a();</span>

                case SYNCHRONIZEDWELL1024A:
<span class="fc" id="L445">                    return new SynchronizedRandomGenerator( new Well1024a() );</span>

                case WELL19937A:
<span class="fc" id="L448">                    return new Well19937a();</span>

                case SYNCHRONIZEDWELL19937A:
<span class="fc" id="L451">                    return new SynchronizedRandomGenerator( new Well19937a() );</span>

                case WELL19937C:
<span class="fc" id="L454">                    return new Well19937c();</span>

                case SYNCHRONIZEDWELL19937C:
<span class="fc" id="L457">                    return new SynchronizedRandomGenerator( new Well19937c() );</span>

                case WELL4449A:
<span class="fc" id="L460">                    return new Well44497a();</span>

                case SYNCHRONIZEDWELL4449A:
<span class="fc" id="L463">                    return new SynchronizedRandomGenerator( new Well44497a() );</span>

                case WELL44497B:
<span class="fc" id="L466">                    return new Well44497b();</span>

                case SYNCHRONIZEDWELL44497B:
<span class="fc" id="L469">                    return new SynchronizedRandomGenerator( new Well44497b() );</span>

                default:
<span class="nc" id="L472">                    throw new CIllegalStateException( org.lightjason.agentspeak.common.CCommon.languagestring( this, &quot;unknown&quot;, this ) );</span>
            }
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.0.201801022044</span></div></body></html>